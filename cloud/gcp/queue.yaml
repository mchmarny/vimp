steps:

  - id: spool
    name: gcr.io/google.com/cloudsdktool/cloud-sdk
    entrypoint: /bin/bash
    args:
    - -c
    - |-
      while read img; do
        # skip comments
        if [[ $img =~ ^[[:space:]]*\#.*$ ]]; then
          continue
        fi
        echo "image: $img"
        gcloud pubsub topics publish image-queue \
          --message "$img" \
          --project $PROJECT_ID
      done < ./image.txt

options:
  pool:
    name: 'projects/$PROJECT_ID/locations/$LOCATION/workerPools/vimp-pool'

tags:
- demo
- s3c