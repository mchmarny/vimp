name: schedule

on:
  # schedule:
  #  - cron: '30 */8 * * *'
  workflow_dispatch:
    inputs:
      image:
        description: 'Debug'
        required: false
        default: 'false'

permissions:
  contents: read

jobs:
  queue-images:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write
    steps:
    - name: Checkout Code
      uses: actions/checkout@c85c95e3d7251135ab7dc9ce3241c5835cc595a9  # v3.5.3
    - name: Spool Images
      env:
        GH_TOKEN: ${{ github.token }}
      run: |-
        while read img; do
          # skip comments
          if [[ $img =~ ^[[:space:]]*\#.*$ ]]; then
            continue
          fi
          echo "image: $img"
          gh workflow run .github/workflows/process.yaml -f image="$img"
        done < ./image.txt
